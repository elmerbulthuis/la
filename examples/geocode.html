<html>
<head>

<title>maps</title>
<script type="text/javascript" src="../lib/la.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

</head>

<body>

<form>
<input type="text" name="search" autocomplete="off" />
</form>

<p id="search">
</p>

<ul id="found">
</ul>

<script type="text/javascript">
	var geocoder = new google.maps.Geocoder();
	var timeoutHandle = 0;

	var search = la('');
	function search_get(err, value){
		if(err === la.CancelException) return;
		if(err) throw err;

		var searchElement = document.getElementById('search');
		while(searchElement.firstChild) searchElement.removeChild(searchElement.firstChild);
		searchElement.appendChild(document.createTextNode(value));
	};
	search.get(search_get);
	search.on('dirty', function(){
		search.get(search_get);
	});

	var found = la(search, function(search, cb){
		timeoutHandle = setTimeout(function(){
			geocoder.geocode({
				address: search	
			}, function(results, status){
				cb(null, results)
			});		
		}, 1000);
	});
	function found_get(err, value){
		if(err === la.CancelException) {
			clearTimeout(timeoutHandle);
			return;
		}
		if(err) throw err;

		var foundElement = document.getElementById('found');
		while(foundElement.firstChild) foundElement.removeChild(foundElement.firstChild);
		
		value
		&& value
		.map(function(item){
			var itemElement = document.createElement('li');
			itemElement.appendChild(document.createTextNode(item.formatted_address));
			return itemElement
		})
		.forEach(function(element){
			foundElement.appendChild(element);
		})
		;
	};
	found.get(found_get);
	found.on('dirty', function(){
		found.get(found_get);
	});






	document.addEventListener('keyup', function(e){

		if(e.target.name == 'search'){
			search.set(e.target.value);
		}

	}, false);
	

</script>


</body>
</html>
